<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Dodge Game Enhanced</title>
  <link rel="manifest" href="/manifest.json">
</head>
<style>
body {
  margin: 0;
  background-color:white;
  font-family: Arial, sans-serif;
  overflow: hidden;
  color: #fff;
}
#hud {
  position: fixed;
  top:0; left:0; right:0;
  display:flex;
  justify-content: space-around;
  align-items:center;
  background: rgba(0,0,0,0.6);
  padding: 6px;
  z-index: 2;
}
#aboutBtn, #pauseBtn {
  background: #007bff;
  border:none;
  color:white;
  padding:6px 12px;
  border-radius:6px;
  cursor:pointer;
}
canvas {
  display: block;
  width: 100vw;
  height: 100vh;
  touch-action: none;
}
#startBtn {
  position: fixed;
  top: 50%; left:50%;
  transform: translate(-50%, -50%);
  background: #28a745;
  color: white;
  border: none;
  padding: 12px 20px;
  border-radius:8px;
  font-size: 18px;
  cursor:pointer;
  z-index:3;
}
/* Modal */
#aboutModal {
  display:none;
  position:fixed;
  top:0;left:0;
  width:100%; height:100%;
  background: rgba(0,0,0,0.7);
  justify-content: center;
  align-items: center;
  z-index:5;
}
#aboutContent {
  background:#222;
  padding:20px;
  border-radius:10px;
  width:90%;
  max-width:400px;
  text-align:left;
  color:#fff;
}
#aboutContent h2 {margin-top:0; color:#00ffcc;}
#closeAbout {
  float:right;
  background:#dc3545;
  color:white;
  border:none;
  padding:6px 12px;
  border-radius:6px;
  cursor:pointer;
}
#gameOverScreen {
  display:none;
  position:fixed;
  top:50%; left:50%;
  transform:translate(-50%,-50%);
  background: rgba(0,0,0,0.85);
  padding: 30px;
  border-radius: 12px;
  text-align:center;
  z-index:10;
  color:white;
}
#gameOverScreen h2{margin:0 0 15px 0; color:#ff4444;}
#gameOverScreen button{
  padding:10px 20px;
  font-size:16px;
  border:none;
  border-radius:8px;
  margin:5px;
  cursor:pointer;
}
#restartBtn { background:#28a745; color:white; }
#exitBtn { background:#dc3545; color:white; }

.email{color:white;}
.email:hover{color:yellow;}
</style>

<body>
<div id="hud">
  <div>Score: <span id="score">0</span></div>
  <div>Level: <span id="level">1</span></div>
  <div>High: <span id="highScore">0</span></div>
  <button id="pauseBtn">Pause</button>
  <button id="aboutBtn">About</button>
</div>

<button id="startBtn">Start Game</button>
<canvas id="gameCanvas"></canvas>

<!-- Game Over screen -->
<div id="gameOverScreen">
  <h2>Game Over!</h2>
  <p>Your Score: <span id="finalScore">0</span></p>
  <button id="restartBtn">Replay</button>
  <button id="exitBtn">Exit</button>
</div>

<!-- About Modal -->
<div id="aboutModal">
  <div id="aboutContent">
    <button id="closeAbout">X</button>
    <h2>About the Game</h2>
    <p><b>Dodge Game Enhanced</b> is a fun 2D survival game. Avoid obstacles (üî¥) and collect coins (ü™ô) and power-ups (üõ°Ô∏è, ‚ö°, üíñ, ‚ù§Ô∏è). Difficulty increases as you level up!</p><br>
    <h2>How to Play</h2>
    <p>Move using arrow keys, mouse, or swipe on mobile. Collect power-ups to gain advantages. Survive as long as possible!</p><br>
    <h2>Developer</h2>
    Developed by <b>Solomon Idowu Michael </b>. Web Developer, Web Apps and Game Developer.<br>

    <p>Support the development of this Game if you enjoy playing, 
      consider donating to help us continue creating new games.<br>

      Donation Link <br><br>
      Account Number :- 2141118486 <br>
      Bank :-  UBA <br>
      Account Holder :- Solomon Idowu Michael.
    </p>
    <a class="email" href="mailto:solomonidowumichael@gmail.com">Contact:solomonidowumichael@gmail.com</a>

  <p>Share The Link of this game with your friends </p>
  <a href="howtoinstall">How to Install This Game </a>
  </div>
</div>

<script>
// service worker
if('serviceWorker' in navigator){
  navigator.serviceWorker.register('sw.js')
    .then(reg => console.log('Service Worker registered', reg))
    .catch(err => console.log('Service Worker failed', err));
}

const canvas = document.getElementById('gameCanvas');
const ctx = canvas.getContext('2d');
const scoreEl = document.getElementById('score');
const levelEl = document.getElementById('level');
const highEl = document.getElementById('highScore');
const startBtn = document.getElementById('startBtn');
const aboutBtn = document.getElementById('aboutBtn');
const aboutModal = document.getElementById('aboutModal');
const closeAbout = document.getElementById('closeAbout');
const gameOverScreen = document.getElementById('gameOverScreen');
const finalScore = document.getElementById('finalScore');
const restartBtn = document.getElementById('restartBtn');
const exitBtn = document.getElementById('exitBtn');
const pauseBtn = document.getElementById('pauseBtn');

function resizeCanvas(){ canvas.width = window.innerWidth; canvas.height = window.innerHeight; }
resizeCanvas();
window.addEventListener('resize', resizeCanvas);

let player, obstacles, powerUps, coins, particles;
let score=0, level=1, obstacleSpeed=3, gameOver=false;
let touchX=null, keys={};
let rafId=null, paused=false;
let highScore = parseInt(localStorage.getItem('dodgeHighScore'))||0;
highEl.textContent=highScore;

// sounds
function playBeep(f=440,d=0.1){
  const o = new (window.AudioContext||window.webkitAudioContext)();
  const osc = o.createOscillator();
  const g = o.createGain();
  osc.connect(g); g.connect(o.destination);
  osc.frequency.value=f; osc.type='sine';
  osc.start(); osc.stop(o.currentTime+d);
}
function playStart(){playBeep(600,0.2);}
function playCollect(){playBeep(800,0.1);}
function playGameOver(){playBeep(200,0.5);}
function playLevelUp(){playBeep(1000,0.15);}

// player
function resetPlayer(){
  player={x:canvas.width/2-25,y:canvas.height-100,width:50,height:50,speed:6,shield:false,speedBoost:false,doubleScore:false,extraLife:false,magnet:false};
}
function resetGame(){
  resetPlayer(); obstacles=[]; powerUps=[]; coins=[]; particles=[];
  score=0; level=1; obstacleSpeed=3; gameOver=false; paused=false;
  scoreEl.textContent=score; levelEl.textContent=level;
  gameOverScreen.style.display='none'; startBtn.style.display='none';
  playStart(); update();
}

// controls
document.addEventListener('keydown', e=>keys[e.key]=true);
document.addEventListener('keyup', e=>keys[e.key]=false);
canvas.addEventListener('mousemove', e=>player.x=e.offsetX-player.width/2);
canvas.addEventListener('touchstart', e=>touchX=e.touches[0].clientX);
canvas.addEventListener('touchmove', e=>{ e.preventDefault(); touchX=e.touches[0].clientX; }, {passive:false});
canvas.addEventListener('touchend', ()=>touchX=null);

function clampPlayer(){ if(player.x<0) player.x=0; if(player.x+player.width>canvas.width) player.x=canvas.width-player.width; }

// entities (spawn/collision same as your code, unchanged) ...
function spawnObstacle(){ const w=30+Math.random()*30; const x=Math.random()*(canvas.width-w); const dir=Math.random()<0.5?1:-1; obstacles.push({x,y:-50,width:w,height:w,dir}); }
function spawnPowerUp(){ const types=['shield','speed','double','life','magnet']; const type=types[Math.floor(Math.random()*types.length)]; const x=Math.random()*(canvas.width-30); powerUps.push({x,y:-30,width:30,height:30,type}); }
function spawnCoin(){ const x=Math.random()*(canvas.width-20); coins.push({x,y:-20,width:20,height:20}); }
function collides(a,b){ return a.x<b.x+b.width && a.x+a.width>b.x && a.y<b.y+b.height && a.y+a.height>b.y; }
function createParticles(x,y,color){ for(let i=0;i<15;i++){ particles.push({x,y,dx:(Math.random()-0.5)*4,dy:(Math.random()-0.5)*-4,life:30,color}); } }

// update loop
function update(){
  if(gameOver || paused) return;

  // same game logic as before
  if(keys['ArrowLeft']||keys['a']) player.x-=player.speed;
  if(keys['ArrowRight']||keys['d']) player.x+=player.speed;
  if(touchX!==null) player.x=touchX-player.width/2;
  clampPlayer();

  // obstacles, powerUps, coins logic unchanged...
  obstacles.forEach(ob=>{ ob.x+=0.5*ob.dir; if(ob.x<0||ob.x+ob.width>canvas.width) ob.dir*=-1; ob.y+=obstacleSpeed;
    if(collides(player,ob)){
      if(player.shield){player.shield=false; obstacles.splice(obstacles.indexOf(ob),1);}
      else if(player.extraLife){player.extraLife=false; obstacles.splice(obstacles.indexOf(ob),1);}
      else {endGame(); return;}
    }
  });
  obstacles = obstacles.filter(ob=>ob.y<canvas.height+50);

  powerUps.forEach((p,i)=>{ p.y+=3;
    if(collides(player,p)){ if(p.type==='shield') player.shield=true;
      if(p.type==='speed'&&!player.speedBoost){player.speedBoost=true;player.speed+=3;setTimeout(()=>{player.speed-=3;player.speedBoost=false;},5000);}
      if(p.type==='double'&&!player.doubleScore){player.doubleScore=true; setTimeout(()=>{player.doubleScore=false;},5000);}
      if(p.type==='life') player.extraLife=true;
      if(p.type==='magnet') player.magnet=true; setTimeout(()=>{player.magnet=false;},5000);
      powerUps.splice(i,1); playCollect(); createParticles(player.x+player.width/2, player.y+player.height/2,'yellow'); }
  });

  coins.forEach((c,i)=>{ c.y+=3;
    if(player.magnet){ if(Math.abs(player.x-c.x)<100) c.x+=(player.x-c.x)*0.05; }
    if(collides(player,c)){ score+=5; coins.splice(i,1); playCollect(); createParticles(c.x+c.width/2, c.y+c.height/2,'gold'); }
  });
  coins = coins.filter(c=>c.y<canvas.height+20);

  if(Math.random()<0.02) spawnObstacle();
  if(Math.random()<0.004) spawnPowerUp();
  if(Math.random()<0.01) spawnCoin();

  score += player.doubleScore?2:1;
  if(score%500===0 && score>0){level++; obstacleSpeed+=0.5; player.speed+=0.2; playLevelUp();}
  scoreEl.textContent=score; levelEl.textContent=level; highEl.textContent=highScore;

  draw();
  rafId=requestAnimationFrame(update);
}
function draw(){ ctx.clearRect(0,0,canvas.width,canvas.height);
  particles.forEach((p,i)=>{ ctx.fillStyle=p.color; ctx.fillRect(p.x,p.y,4,4); p.x+=p.dx; p.y+=p.dy; p.life--; if(p.life<=0) particles.splice(i,1); });
  ctx.font=`${player.height}px Arial`; ctx.fillText(player.shield?'üõ°Ô∏è':player.speedBoost?'‚ö°':player.doubleScore?'üíñ':player.extraLife?'‚ù§Ô∏è':'üü©', player.x, player.y+player.height);
  obstacles.forEach(ob=>ctx.fillText('üî¥', ob.x, ob.y+ob.height));
  powerUps.forEach(p=>{ let e=p.type==='shield'?'üõ°Ô∏è':p.type==='speed'?'‚ö°':p.type==='double'?'üíñ':p.type==='life'?'‚ù§Ô∏è':'ü™ô'; ctx.fillText(e,p.x,p.y+p.height); });
  coins.forEach(c=>ctx.fillText('ü™ô',c.x,c.y+c.height));
}
function endGame(){
  gameOver=true; cancelAnimationFrame(rafId); playGameOver();
  if(score>highScore){ highScore=score; localStorage.setItem('dodgeHighScore',highScore);}
  finalScore.textContent=score; gameOverScreen.style.display='block';
}

// buttons
startBtn.addEventListener('click',()=>resetGame());
restartBtn.addEventListener('click',()=>resetGame());
exitBtn.addEventListener('click',()=>{ location.reload(); });
pauseBtn.addEventListener('click',()=>{
  if(!paused){ paused=true; cancelAnimationFrame(rafId); pauseBtn.textContent="Resume"; }
  else { paused=false; pauseBtn.textContent="Pause"; update(); }
});

// about modal
aboutBtn.addEventListener('click',()=>{aboutModal.style.display='flex';});
closeAbout.addEventListener('click',()=>{aboutModal.style.display='none';});
aboutModal.addEventListener('click', e=>{if(e.target===aboutModal) aboutModal.style.display='none';});
</script>
</body>
</html>

